# 🤖 RAG手动数据导出使用指南

**创建时间**: 2025-07-01  
**系统状态**: ✅ 完全可用  
**推荐方式**: 手动数据导出

---

## 🎯 **手动数据导出的优势**

### **为什么选择手动导出？**
✅ **避免重复embedding**: 一次处理，多次使用，节省API调用成本  
✅ **更可控**: 可以选择特定数据集，控制数据质量和数量  
✅ **更快启动**: 跳过数据提取步骤，直接使用预处理数据  
✅ **离线使用**: 数据文件可以离线处理和管理  
✅ **版本管理**: 可以保存不同版本的数据快照  

### **与自动方式对比**
| 特性 | 手动导出 | 自动处理 |
|------|----------|----------|
| 启动速度 | ⚡ 快速 | 🐌 较慢 |
| API消耗 | 💰 一次性 | 💸 每次都消耗 |
| 可控性 | 🎯 高度可控 | 🤖 自动化 |
| 数据版本 | 📦 可管理 | 🔄 实时 |

---

## 📋 **完整使用流程**

### **第1步：导出房源数据**

#### **运行导出脚本**
```bash
python export_data_for_rag.py
```

#### **选择导出选项**
```
请选择导出方式:
1. 导出全部数据到JSON (推荐) - 10,783条数据，约4MB
2. 导出全部数据到CSV - 10,783条数据，CSV格式
3. 导出1000条测试数据到JSON - 快速测试用
4. 导出1000条测试数据到CSV - 快速测试用
5. 退出
```

#### **推荐选择**
- **生产使用**: 选择 `1` (全部数据JSON)
- **快速测试**: 选择 `3` (1000条测试数据)

#### **导出结果**
```
✅ 导出完成！
📁 文件路径: rag_module/documents/houses_export_20250701_201103.json
📊 导出数量: 10783 条
💾 文件大小: 4.09 MB

📝 示例数据:
  1. 元邦航空家园 - 番禺 - 3900元/月
  2. 保利天汇 - 增城 - 1800元/月
  3. 越秀滨海珺城 - 天河 - 2700元/月
```

### **第2步：使用RAG系统**

#### **访问RAG界面**
- **地址**: http://127.0.0.1:8000/mongo/rag/
- **账户**: test4071741 / 0515

#### **选择数据源**
登录后，如果系统未初始化，会看到：
```
系统未初始化，请选择数据源...
[从MongoDB初始化] [从文件初始化] [查看数据文件]
```

#### **从文件初始化**
1. 点击 `从文件初始化` 按钮
2. 系统会显示可用文件列表
3. 选择刚才导出的文件编号
4. 等待系统初始化完成

#### **示例对话**
```
请选择数据文件:

1. houses_export_20250701_201103.json (4.09MB, json)
2. houses_test_100.json (0.04MB, json)

请输入文件编号: 1
```

### **第3步：开始智能问答**

#### **系统初始化完成**
```
✅ RAG系统从文件初始化完成: houses_export_20250701_201103.json
```

#### **开始问答**
现在可以输入任何关于房源的问题：
- "海珠区有什么房子？"
- "3室2厅的房子价格如何？"
- "最便宜的房子在哪里？"
- "推荐一些性价比高的房源"

---

## 🔧 **高级功能**

### **查看数据文件**
点击 `查看数据文件` 按钮可以查看所有可用的数据文件：
```
找到 11 个数据文件:

1. houses_export_20250701_201103.json
   大小: 4.09MB
   类型: json
   修改时间: 2025-07-01 20:11:03

2. houses_test_100.json
   大小: 0.04MB
   类型: json
   修改时间: 2025-07-01 19:57:47
```

### **系统管理功能**
- **系统状态**: 查看当前系统运行状态
- **清空缓存**: 清理内存缓存释放资源
- **重建索引**: 使用新数据文件重建向量索引

### **数据文件管理**
- **位置**: `rag_module/documents/` 目录
- **格式**: JSON (推荐) 或 CSV
- **命名**: `houses_export_YYYYMMDD_HHMMSS.json`
- **备份**: 可以保存多个版本的数据文件

---

## 📊 **数据文件格式**

### **JSON格式示例**
```json
[
  {
    "id": "67a1234567890abcdef12345",
    "title": "元邦航空家园",
    "rental_type": "整租",
    "city": "番禺",
    "district": "未知区域",
    "street": "未知街道",
    "area": 85.0,
    "room_type": "3室2厅",
    "direction": "南北",
    "monthly_rent": 3900.0,
    "tags": "精装,近地铁",
    "status": "可租",
    "house_id": "GZ001",
    "export_time": "2025-07-01T20:11:03.123456"
  }
]
```

### **字段说明**
- **id**: MongoDB文档ID
- **title**: 房源标题
- **rental_type**: 租赁类型(整租/合租)
- **city**: 城市
- **district**: 区域
- **street**: 街道
- **area**: 面积(平方米)
- **room_type**: 户型
- **direction**: 朝向
- **monthly_rent**: 月租金(元)
- **tags**: 标签(逗号分隔)
- **status**: 状态
- **house_id**: 房源编号
- **export_time**: 导出时间

---

## ⚡ **性能优化**

### **数据量建议**
- **测试环境**: 100-1000条数据
- **开发环境**: 1000-5000条数据
- **生产环境**: 全量数据(10,783条)

### **文件大小参考**
- **100条数据**: ~44KB
- **1000条数据**: ~440KB
- **10,783条数据**: ~4.09MB

### **初始化时间**
- **100条数据**: ~30秒
- **1000条数据**: ~2分钟
- **10,783条数据**: ~10分钟

---

## 🛠️ **故障排除**

### **常见问题**

#### **Q: 导出脚本运行失败**
A: 确保Django环境正确配置，MongoDB服务正常运行

#### **Q: 文件列表为空**
A: 检查 `rag_module/documents/` 目录是否存在数据文件

#### **Q: 初始化失败**
A: 检查网络连接，确保火山方舟API可用

#### **Q: 中文路径问题**
A: 系统已自动使用临时目录避免中文路径问题

### **日志查看**
- **Django日志**: 在Django服务器控制台查看
- **RAG日志**: `rag_module/logs/rag.log`

---

## 📞 **技术支持**

### **文件位置**
- **导出脚本**: `export_data_for_rag.py`
- **数据目录**: `rag_module/documents/`
- **配置文件**: `rag_module/config.py`
- **测试脚本**: `test_file_init.py`

### **关键命令**
```bash
# 导出数据
python export_data_for_rag.py

# 测试文件列表
python test_file_list.py

# 测试文件初始化
python test_file_init.py

# 启动Django服务器
python manage.py runserver 8000
```

---

**文档版本**: v1.0  
**最后更新**: 2025-07-01  
**系统状态**: 🚀 **手动数据导出功能完全可用**
